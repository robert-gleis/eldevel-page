---
import { content } from '../content/de.ts';

// Helper function to build correct asset paths
const getAssetPath = (path: string) => {
  const baseUrl = import.meta.env.BASE_URL;
  // Remove trailing slash from baseUrl if it exists
  const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;
  return cleanBaseUrl + '/' + (path.startsWith('/') ? path.slice(1) : path);
};

// Check if we're on the homepage to determine link behavior
const currentPath = Astro.url.pathname;
const isHomepage = currentPath === '/' || currentPath === '/index.html';
const linkPrefix = isHomepage ? '' : '/';
---

<header class="navbar">
  <div class="container-custom">
    <div class="flex items-center justify-between h-16 md:h-20">
      
      <!-- Logo/Brand -->
      <div class="flex items-center">
        <a href="/" class="flex items-center">
          <img 
            src={getAssetPath("images/eldevel-logo.png")} 
            alt="eldevel – Electronics Development"
            class="h-10 md:h-12 w-auto"
            loading="eager"
          />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-8">
        <a href={`${linkPrefix}#unternehmen`} class="nav-link">{content.navigation.company}</a>
        <a href={`${linkPrefix}#qualitaet`} class="nav-link">{content.navigation.quality}</a>
        <a href={`${linkPrefix}#leistungen`} class="nav-link">{content.navigation.services}</a>
        <a href={`${linkPrefix}#prozess`} class="nav-link">{content.navigation.process}</a>
        <a href={`${linkPrefix}#kontakt`} class="nav-link">{content.navigation.contact}</a>
      </nav>

      <!-- Desktop CTA -->
      <div class="hidden md:flex items-center">
        <a href={`${linkPrefix}#kontakt`} class="btn-primary">
          {content.hero.cta_primary}
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-toggle" 
        class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
        aria-label="Toggle mobile menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu -->
<div id="mobile-menu" class="mobile-menu mobile-menu-closed">
  <div class="flex flex-col h-full">
    
    <!-- Mobile Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
      <div class="flex items-center">
                         <img 
                   src={getAssetPath("images/eldevel-logo.png")} 
                   alt="eldevel – Electronics Development"
                   class="h-10 w-auto"
                   loading="eager"
                 />
      </div>
      <button 
        id="mobile-menu-close" 
        class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
        aria-label="Close mobile menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <nav class="flex-1 px-4 py-6 space-y-4">
      <a href={`${linkPrefix}#unternehmen`} class="mobile-nav-link">{content.navigation.company}</a>
      <a href={`${linkPrefix}#leistungen`} class="mobile-nav-link">{content.navigation.services}</a>
      <a href={`${linkPrefix}#prozess`} class="mobile-nav-link">{content.navigation.process}</a>
      <a href={`${linkPrefix}#kontakt`} class="mobile-nav-link">{content.navigation.contact}</a>
    </nav>

    <!-- Mobile Footer -->
    <div class="p-4 border-t border-gray-200">
      <a href={`${linkPrefix}#kontakt`} class="btn-primary w-full text-center">
        {content.hero.cta_primary}
      </a>
    </div>
  </div>
</div>

<!-- Navigation & Dark Mode JavaScript -->
<script>
  // Mobile Menu Toggle
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenuClose = document.getElementById('mobile-menu-close');
  const mobileMenu = document.getElementById('mobile-menu');

  function openMobileMenu() {
    mobileMenu?.classList.remove('mobile-menu-closed');
    mobileMenu?.classList.add('mobile-menu-open');
    document.body.style.overflow = 'hidden';
  }

  function closeMobileMenu() {
    mobileMenu?.classList.remove('mobile-menu-open');
    mobileMenu?.classList.add('mobile-menu-closed');
    document.body.style.overflow = '';
  }

  mobileMenuToggle?.addEventListener('click', openMobileMenu);
  mobileMenuClose?.addEventListener('click', closeMobileMenu);

  // Close mobile menu when clicking on navigation links
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
  mobileNavLinks.forEach(link => {
    link.addEventListener('click', closeMobileMenu);
  });


  // Close mobile menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeMobileMenu();
    }
  });

  // Close mobile menu when clicking outside
  mobileMenu?.addEventListener('click', (e) => {
    if (e.target === mobileMenu) {
      closeMobileMenu();
    }
  });
</script>

<style>
  .nav-link {
    @apply text-gray-700 hover:text-primary-600 font-medium transition-colors;
  }

  .mobile-nav-link {
    @apply block text-lg font-medium text-gray-700 hover:text-primary-600 py-3 transition-colors;
  }

  .mobile-menu-closed {
    transform: translateX(100%);
  }

  .mobile-menu-open {
    transform: translateX(0);
  }
</style>
